import{r as p,a as c,j as e,F as C}from"./jsx-runtime-7cf68bf7.js";import{b as h,p as f,a as v,L as l,c as y,f as x,T as M,a2 as V,a3 as j,a4 as Y,a5 as b,a6 as B,N as F,a7 as G,a8 as H,a9 as _}from"./PhoneProvider-d476cfa1.js";import"./number-28525126.js";function R({app:s,showImages:r,big:a}){const{fetchAndSetAppInfo:i}=p.useContext(k),t=h(v.Settings),d=h(y),m=h(P),u=p.useRef(m),g=p.useRef(!0);p.useEffect(()=>{if(g.current){g.current=!1;return}},[t.apps]),p.useEffect(()=>{u.current=m},[m]);const S=()=>{let n=1,o;for(;;){if(t.apps[n]||(t.apps[n]=[]),o=t.apps[n].filter(A=>d.apps[A]!==void 0),o.length<24)return n;n++}},E=async()=>new Promise(async n=>{P.set([...P.value,{app:s.key,progress:20}]),n(await w())}),w=()=>new Promise(n=>{let o=S(),A={...t};A.apps[o??1].push(s.key),v.Settings.set(A),x("setSettings",A);let L=setInterval(()=>{u.current.forEach(N=>{if(N.app==s.key){let O=Math.floor(Math.random()*2)+1.5;if(N.progress+O>=100){N.progress=100;let I=P.value.filter(D=>D.app!=s.key);P.set(I),u.current=I}else N.progress+=O;P.set([...P.value.filter(I=>I.app!==s.key),N])}(u.current.length==0||u.current.every(O=>O.progress==100))&&(P.reset(),clearInterval(L),n(!0))})},250)});return p.useEffect(()=>{if(!a)return;const n=document.querySelector(".images");if(n)return n.addEventListener("wheel",o=>{o.preventDefault(),n.scrollLeft+=o.deltaY}),()=>{n.removeEventListener("wheel",o=>{o.preventDefault(),n.scrollLeft+=o.deltaY})}},[a]),c("div",{className:"app-item",onClick:()=>{a||i(s)},style:{cursor:a?"default":"pointer"},children:[c("div",{className:"upper",children:[c("div",{className:"app-info","data-big":a,children:[e("img",{className:"app-icon",src:s.icon??`./assets/img/icons/apps/${s.key}.png`}),c("div",{className:"app-content",children:[c("div",{className:"text",children:[e("div",{className:"app-name",children:s.name}),e("div",{className:"app-description",children:s.description})]}),a&&e(T,{app:s,installed:f(s.key,t.apps),installing:u.current.some(n=>n.app==s.key)&&u.current.find(n=>n.app==s.key).progress<100,cb:()=>{E().then(()=>{v.Settings.patch({storage:{...t.storage,used:t.storage.used+s.size}})})}})]})]}),!a&&e(T,{app:s,installed:f(s.key,t.apps),installing:u.current.some(n=>n.app==s.key)&&u.current.find(n=>n.app==s.key).progress<100,cb:()=>{E().then(()=>{v.Settings.patch({storage:{...t.storage,used:t.storage.used+s.size}})})}})]}),(a||r)&&s.images&&s.images.length>=0&&(a||!f(s.key,t.apps)||m.filter(n=>n.app===s.key).length>0)&&e("div",{className:"images","data-big":a,children:s.images&&s.images.filter((n,o)=>a?!0:o<3).map((n,o)=>e("img",{src:n},o))}),a&&c("section",{children:[e("div",{className:"title",children:l("APPS.APPSTORE.INFORMATION")}),c("div",{className:"items",children:[c("div",{className:"item",children:[e("div",{className:"title",children:l("APPS.APPSTORE.PROVIDER")}),e("div",{className:"value",children:(s.custom&&s.developer)??"LB Phone"})]}),c("div",{className:"item",children:[e("div",{className:"title",children:l("APPS.APPSTORE.SIZE")}),c("div",{className:"value",children:[s.size/1e3," MB"]})]}),c("div",{className:"item",children:[e("div",{className:"title",children:l("APPS.APPSTORE.COMPATIBILITY")}),e("div",{className:"value",children:"Works with this Phone"})]}),c("div",{className:"item",children:[e("div",{className:"title",children:l("APPS.APPSTORE.IN_APP_PURCHASES")}),e("div",{className:"value",children:"No"})]})]})]})]})}const T=({app:s,installed:r,installing:a,cb:i})=>a?e(M,{size:25,lineWeight:5,speed:3,color:"#0a84ff"}):r?e("div",{className:"button",onClick:t=>{t.stopPropagation(),v.App.set({name:s.key})},children:l("APPS.APPSTORE.OPEN")}):e("div",{className:"button",onClick:t=>{t.stopPropagation(),i()},children:l("APPS.APPSTORE.GET")});function $(){const{App:s}=p.useContext(k),[r]=s;return e("div",{className:"appstore-app",children:e("div",{className:"appstore-app-body",children:e(R,{app:r,big:!0})})})}function z(){const s=h(v.Settings),r=h(y);return e("div",{className:"appstore-page left",children:c("section",{children:[e("div",{className:"title",children:"Popular Apps"}),e("div",{className:"apps",children:Object.keys(r.apps).filter(a=>{var i;return((i=r.apps[a])==null?void 0:i.removable)&&!r.apps[a].game}).map((a,i)=>{if(!r.apps[a])return;let t={...r.apps[a],key:a};return e(R,{app:{...t,installed:f(t.key,s.apps)}},i)})})]})})}function W(){const s=h(v.Settings),r=h(y);return e("div",{className:"appstore-page left",children:c("section",{children:[e("div",{className:"title",children:l("APPS.APPSTORE.WHAT_WE_PLAYING")}),e("div",{className:"apps",children:Object.keys(r.apps).filter(a=>{var i;return((i=r.apps[a])==null?void 0:i.removable)&&r.apps[a].game}).map((a,i)=>{if(!r.apps[a])return;let t={...r.apps[a],key:a};return e(R,{app:{...t,installed:f(t.key,s.apps)}},i)})})]})})}function U(){const{View:s}=p.useContext(k),[r,a]=s,i=[{name:l("APPS.APPSTORE.TODAY"),value:"today",icon:e(V,{})},{name:l("APPS.APPSTORE.GAMES"),value:"games",icon:e(j,{})},{name:l("APPS.APPSTORE.TITLE"),value:"apps",icon:e(Y,{})},{name:l("APPS.APPSTORE.SEARCH"),value:"search",icon:e(b,{})}];return e("div",{className:"appstore-footer",children:i.map((t,d)=>c("div",{className:"item","data-active":t.value===r,onClick:()=>a(t.value),children:[t.icon,e("div",{className:"name",children:t.name})]},d))})}function q({hidden:s}){const{View:r,LastPage:a}=p.useContext(k),i=h(y),[t,d]=r,[m]=a,u={today:l("APPS.APPSTORE.TODAY"),apps:l("APPS.APPSTORE.APPS"),games:l("APPS.APPSTORE.GAMES"),search:l("APPS.APPSTORE.SEARCH")};return e(C,{children:c("div",{className:"appstore-header",children:[c("div",{className:"info",children:[t==="today"&&e("div",{className:"date",children:(()=>{const S=new Date,E=S.toLocaleString(i.DateLocale,{weekday:"long"}),w=S.getDate(),n=S.toLocaleString(i.DateLocale,{month:"long"});return`${E.toUpperCase()} ${w} ${n.toUpperCase()}`})()}),t==="app"?c("div",{className:"back",onClick:()=>d(m),children:[e(B,{}),F(m)]}):e("div",{className:"title",children:u[t]})]}),e(G,{})]})})}function Z(){const s=h(v.Settings),r=h(y),[a,i]=p.useState("");return c("div",{className:"appstore-search left",children:[e(H,{placeholder:"Search",onChange:t=>i(t.target.value)}),e("div",{className:"app-list",children:Object.keys(r.apps).filter(t=>{var d;return(d=r.apps[t])==null?void 0:d.removable}).filter(t=>t.toLowerCase().includes(a.toLowerCase())).map((t,d)=>{if(!r.apps[t])return;let m={...r.apps[t],key:t};return e(R,{app:{...m,installed:f(m.key,s.apps)},showImages:!0},d)})})]})}const k=p.createContext(null),P=_([]);function X(){const[s,r]=p.useState("search"),[a,i]=p.useState("search"),[t,d]=p.useState(null),m={app:e($,{}),games:e(W,{}),apps:e(z,{}),search:e(Z,{})},u=g=>{d(g),i(s),r("app")};return e("div",{className:"appstore-container",children:e(C,{children:c(k.Provider,{value:{View:[s,r],App:[t,d],LastPage:[a,i],fetchAndSetAppInfo:u},children:[e(q,{hidden:s==="app"}),e("div",{className:"appstore-wrapper",children:m[s]}),e(U,{})]})})})}export{k as AppStoreContext,P as Downloads,X as default};
